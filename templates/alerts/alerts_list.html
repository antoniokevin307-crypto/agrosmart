{% extends "base.html" %}
{% block content %}
<h2>Alertas</h2>
<table class="table">
  <thead>
    <tr><th>Id</th><th>Cultivo</th><th>Tipo</th><th>Mensaje</th><th>Creado</th><th>Notificado</th><th>Resuelto</th><th>Acciones</th></tr>
  </thead>
  <tbody>
    {% for a in alerts %}
    <tr>
      <td>{{ a.id }}</td>
      <td>{{ a.crop.name }}</td>
      <td>{{ a.get_alert_type_display }}</td>
      <td>{{ a.message|truncatewords:20 }}</td>
      <td>{{ a.created_at }}</td>
      <td>{{ a.notified }}</td>
      <td>{{ a.resolved }}</td>
      <td>
        {% if not a.resolved %}
        <form method="post" action="{% url 'resolve_alert' a.id %}" style="display:inline;">
          {% csrf_token %}
          <input type="hidden" name="response" value="resuelto_manual">
          <button class="btn" type="submit" style="background:#28a745;color:white;">Marcar resuelto</button>
        </form>
        {% else %}
          {{ a.user_response }}
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="8">No hay alertas.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
